<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å—äº¬å¸‚é‡ç‚¹å•†ä¸šé¡¹ç›®åœ°å›¾ (2025å¹´)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-measure@2.1.7/dist/leaflet-measure.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        :root {
            --primary-color: #007bff;
            --primary-hover-color: #0056b3;
            --danger-color: #dc3545;
            --danger-hover-color: #c82333;
            --secondary-color: #6c757d;
            --secondary-hover-color: #5a6268;
            --light-gray-color: #f8f9fa;
            --medium-gray-color: #e9ecef;
            --dark-gray-color: #6c757d;
            --font-color: #343a40;
            --font-color-light: #6c757d;
            --background-color: #ffffff;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f4f4;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #map {
            height: 100%;
            width: 100%;
            z-index: 1;
        }

        /* General Info Box Styling (for Legend and Title) */
        .info {
            padding: 12px 15px;
            background: var(--background-color);
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            line-height: 1.6;
            color: var(--font-color);
            font-size: 14px;
            cursor: move;
            user-select: none;
        }
        
        /* Info Box Header for Dragging */
        .info h4 {
            cursor: move;
            user-select: none;
            margin: 0 0 10px;
            color: var(--font-color);
            font-weight: 600;
            font-size: 16px;
            border-bottom: 1px solid var(--medium-gray-color);
            padding-bottom: 8px;
        }

        .info h4 {
            margin: 0 0 10px;
            color: var(--font-color);
            font-weight: 600;
            font-size: 16px;
            border-bottom: 1px solid var(--medium-gray-color);
            padding-bottom: 8px;
        }

        /* Legend Specifics */
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            border-radius: 50%;
            opacity: 0.9;
        }
        .legend .project-grade {
            margin-bottom: 4px;
        }

        /* Popup Styling */
        .popup-content {
            max-width: 300px;
            font-size: 14px;
            line-height: 1.7;
        }
        .popup-content b {
            font-weight: 600;
            color: var(--font-color);
        }
        .popup-content .poi-search-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background-color var(--transition-speed);
        }
        .popup-content .poi-search-btn:hover {
            background-color: var(--primary-hover-color);
        }

        .project-grade {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            font-size: 12px;
            margin: 4px 0;
        }

        .grade-Aplus { background-color: #d73027; }
        .grade-A { background-color: #f46d43; }
        .grade-Aminus { background-color: #fdae61; }
        .grade-B { background-color: #4575b4; }
        .grade-C { background-color: #abd9e9; color: #333; }
        .grade-none { background-color: #e0e0e0; color: #555; }

        /* Main Control Panel */
        #radius-control {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--background-color);
            padding: 20px;
            border-radius: var(--border-radius);
            z-index: 1000;
            box-shadow: var(--box-shadow);
            width: 280px;
            max-height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: move;
            user-select: none;
        }
        
        /* Draggable Window Header */
        .control-header {
            cursor: move;
            user-select: none;
        }
        
        /* Reset Button */
        .reset-btn {
            background: var(--danger-color) !important;
            color: white !important;
            border: none;
            border-radius: 6px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
            transition: background-color var(--transition-speed);
        }
        .reset-btn:hover {
            background: var(--danger-hover-color) !important;
        }

        .control-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray-color);
        }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .control-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--font-color);
            margin: 0;
        }
        .toggle-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-speed);
        }
        .toggle-btn:hover {
            background: var(--secondary-hover-color);
        }
        .control-subtitle {
            font-size: 13px;
            color: var(--font-color-light);
            margin: 5px 0 0;
        }

        /* ä¼˜åŒ–åçš„éšè—åŠŸèƒ½æ ·å¼ */
        #radius-control .toggle-btn::before {
            content: 'âœ•';
            font-weight: normal;
        }

        #radius-control input, #radius-control select {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
        }
        #radius-control input:focus, #radius-control select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        #radius-control button {
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            color: white;
            background-color: var(--primary-color);
            transition: background-color var(--transition-speed), transform var(--transition-speed);
        }
        #radius-control button:hover {
            background-color: var(--primary-hover-color);
            transform: translateY(-1px);
        }

        /* Tab Container */
        .tab-container {
            display: flex;
            margin-bottom: 15px;
            background-color: var(--light-gray-color);
            border-radius: 6px;
            padding: 4px;
        }
        .tab-btn {
            flex: 1;
            padding: 8px 10px;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--font-color-light);
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }
        .tab-btn.active {
            background-color: var(--background-color);
            color: var(--primary-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Records Section */
        #records-section {
            margin-top: 10px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .records-list {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px; /* For scrollbar */
        }
        #no-records {
            text-align: center;
            padding: 40px 20px;
            color: var(--font-color-light);
            font-size: 14px;
            line-height: 1.6;
        }
        
        .records-stats {
            font-size: 12px;
            color: var(--font-color-light);
            text-align: center;
            margin-bottom: 10px;
            padding: 5px;
            background: var(--light-gray-color);
            border-radius: 4px;
        }
        .records-stats span {
            font-weight: 600;
            color: var(--font-color);
        }

        .record-item {
            background: var(--background-color);
            border: 1px solid var(--medium-gray-color);
            border-left-width: 4px;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 13px;
            transition: box-shadow var(--transition-speed);
        }
        .record-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .record-title {
            font-weight: 700;
            font-size: 15px;
        }
        .record-delete {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: background-color var(--transition-speed);
        }
        .record-delete:hover {
            background: var(--danger-hover-color);
        }

        .record-info {
            color: var(--font-color-light);
            line-height: 1.6;
        }
        .record-info strong {
            color: var(--font-color);
            font-weight: 500;
        }
        .record-info details summary {
            cursor: pointer;
            font-weight: 500;
            color: var(--secondary-color);
            outline: none;
        }
        .record-info details[open] summary {
            color: var(--primary-color);
        }

        .clear-all-btn {
            background: var(--secondary-color) !important;
            color: white !important;
            margin-top: 10px;
        }
        .clear-all-btn:hover {
            background: var(--secondary-hover-color) !important;
        }
        
        /* Leaflet Measure Control Customization */
        .leaflet-control-measure {
            border-radius: var(--border-radius) !important;
            box-shadow: var(--box-shadow) !important;
        }
        .leaflet-control-measure .leaflet-control-measure-toggle,
        .leaflet-control-measure .leaflet-control-measure-toggle:hover {
            border-radius: var(--border-radius) !important;
        }
        
        /* Radius Mode Prompt */
        #radius-mode-prompt {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            background-color: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* POI Search Modal Styles */
        #poi-search-modal {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            background: white;
            z-index: 2001;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            flex-direction: column;
        }
        #poi-search-modal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--medium-gray-color);
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        #poi-search-modal .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--font-color);
        }
        #poi-search-modal .modal-close-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--secondary-color);
        }
        #poi-search-modal input {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        #poi-search-modal .modal-search-btn {
            width: 100%;
            padding: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        #poi-search-modal .modal-search-btn:hover {
            background-color: var(--primary-hover-color);
        }
        #poi-results {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 13px;
        }
        #poi-results .poi-item {
            padding: 8px;
            border-bottom: 1px solid var(--light-gray-color);
        }
        #poi-results .poi-item:last-child {
            border-bottom: none;
        }

        /* Style for POI search result markers */
        .marker-pin {
            width: 15px; /* Increased size */
            height: 15px; /* Increased size */
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.6); /* More prominent shadow */
            border: 2px solid white; /* Thicker border */
        }
        .custom-div-icon {
            background: transparent;
            border: none;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div id="radius-control">
        <div class="control-header">
            <div class="header-top">
                <h3 class="control-title">èŒƒå›´æŸ¥è¯¢å·¥å…·</h3>
                <button id="toggle-control" class="toggle-btn" title="éšè—æ§åˆ¶é¢æ¿"></button>
            </div>
            <p class="control-subtitle">ç‚¹å‡»åœ°å›¾ä»»æ„ä½ç½®åˆ›å»ºæŸ¥è¯¢èŒƒå›´ï¼Œåˆ†æå‘¨è¾¹å•†ä¸šåˆ†å¸ƒ</p>
        </div>
        
        <input type="number" id="radius-input" value="1" min="0.1" step="0.1" title="è¾“å…¥åŠå¾„" placeholder="è¾“å…¥æŸ¥è¯¢åŠå¾„">
        <select id="radius-unit" title="é€‰æ‹©å•ä½">
            <option value="kilometers">å…¬é‡Œ (km)</option>
            <option value="meters">ç±³ (m)</option>
        </select>
        <button id="radius-button">ğŸ¯ å¼€å§‹èŒƒå›´æŸ¥è¯¢</button>
        
        <div id="records-section">
            <div class="tab-container">
                <button class="tab-btn active" id="current-tab">å½“å‰èŒƒå›´</button>
                <button class="tab-btn" id="history-tab">å†å²è®°å½•</button>
            </div>
            
            <div class="records-stats" id="records-stats" style="display: none;">
                <span id="total-records">0</span> ä¸ªæŸ¥è¯¢è®°å½• | å…±å‘ç° <span id="total-malls">0</span> ä¸ªå•†åœº
            </div>
            
            <div class="records-list" id="records-list">
                <div id="no-records">æš‚æ— æŸ¥è¯¢è®°å½•<br>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹èŒƒå›´æŸ¥è¯¢</div>
            </div>
            <button class="clear-all-btn" id="clear-all-btn" style="display: none;">ğŸ—‘ï¸ æ¸…é™¤èŒƒå›´è®°å½•</button>
            <button class="clear-all-btn" id="clear-poi-btn" style="display: none; margin-top: 5px;">âœ¨ æ¸…é™¤æœç´¢ç»“æœ</button>
        </div>
    </div>

    <!-- POI Search Modal -->
    <div id="poi-search-modal">
        <div class="modal-header">
            <span id="poi-modal-title" class="modal-title">å‘¨è¾¹æœç´¢</span>
            <button id="poi-modal-close-btn" class="modal-close-btn">&times;</button>
        </div>
        <input type="text" id="poi-keyword-input" placeholder="ä¾‹å¦‚: å’–å•¡, é¤å…, å……ç”µç«™">
        <button id="poi-search-btn" class="modal-search-btn">æœç´¢</button>
        <div id="poi-results"></div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.chinesetmsproviders@1.0.22/src/leaflet.ChineseTmsProviders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-measure@2.1.7/dist/leaflet-measure.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-measure@2.1.7/dist/leaflet-measure.cn.js"></script>
    <script>
        // åˆ›å»ºåœ°å›¾å®ä¾‹ï¼Œè®¾ç½®ä¸­å¿ƒç‚¹å’Œç¼©æ”¾çº§åˆ«
        var map = L.map("map").setView([32.06, 118.78], 12);
        
        // æ·»åŠ é«˜å¾·åœ°å›¾å›¾å±‚
        L.tileLayer.chinaProvider('GaoDe.Normal.Map', {
            maxZoom: 18,
            minZoom: 10,
            attribution: 'é«˜å¾·åœ°å›¾'
        }).addTo(map);
        
        // --- æ•°æ®å’Œé…ç½® ---
        const districtStyles = {
            "æ–°è¡—å£å•†åœˆ": { color: "#e41a1c", name: "æ–°è¡—å£" },
            "å¤«å­åº™å•†åœˆ": { color: "#377eb8", name: "å¤«å­åº™" },
            "å…ƒé€šå•†åœˆ":   { color: "#4daf4a", name: "å…ƒé€š" },
            "æ±Ÿä¸œå•†åœˆ":   { color: "#ff7f00", name: "æ±Ÿä¸œ" },
            "æ±ŸåŒ—å•†åœˆ":   { color: "#ffd700", name: "æ±ŸåŒ—" },
            "æ¡¥åŒ—å•†åœˆ":   { color: "#ffff33", name: "æ¡¥åŒ—" },
            "ç™¾å®¶æ¹–å•†åœˆ": { color: "#a65628", name: "ç™¾å®¶æ¹–" },
            "ä»™æ—å•†åœˆ":   { color: "#999999", name: "ä»™æ—" },
            "æµ¦å£å•†åœˆ":   { color: "#984ea3", name: "æµ¦å£" },
            "ç„æ­¦å•†åœˆ":   { color: "#e41a1c", name: "ç„æ­¦" }, // Re-using color for example
            "ä¸­å¤®é—¨å•†åœˆ": { color: "#000000", name: "ä¸­å¤®é—¨" },
            "è¿ˆçš‹æ¡¥å•†åœˆ": { color: "#00ffff", name: "è¿ˆçš‹æ¡¥" },
            "å…­åˆåŒºå•†åœˆ": { color: "#ff69b4", name: "å…­åˆåŒº" },
            "æº§æ°´åŒºå•†åœˆ": { color: "#8a2be2", name: "æº§æ°´åŒº" },
            "é«˜æ·³åŒºå•†åœˆ": { color: "#dc143c", name: "é«˜æ·³åŒº" },
            "æ –éœåŒºå•†åœˆ": { color: "#228b22", name: "æ –éœåŒº" },
            "é›¨èŠ±å°å•†åœˆ": { color: "#ff1493", name: "é›¨èŠ±å°" }
        };

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šåœ°å›¾åˆå§‹åŒ–å’Œæ ‡è®° --- 

        // åŠ¨æ€åˆ›å»ºå¸¦é¢œè‰²çš„ SVG å›¾æ ‡
        function createColoredIcon(color) {
            const svgIcon = window.btoa(`
                <svg width="25" height="41" viewBox="0 0 25 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.5 0C5.596 0 0 5.596 0 12.5C0 19.404 5.596 25 12.5 25C19.404 25 25 19.404 25 12.5C25 5.596 19.404 0 12.5 0Z" fill="${color}"/>
                    <path d="M12.5 35.5C18.299 35.5 23 30.799 23 25H2C2 30.799 6.701 35.5 12.5 35.5Z" fill="${color}"/>
                    <circle cx="12.5" cy="12.5" r="6" fill="#ffffff"/>
                </svg>
            `);

            return L.icon({
                iconUrl: `data:image/svg+xml;base64,${svgIcon}`,
                shadowUrl: "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
        }

        // ä¸ºæ¯ä¸ªå•†åœˆé£æ ¼ç”Ÿæˆå›¾æ ‡å®ä¾‹
        for (const key in districtStyles) {
            districtStyles[key].icon = createColoredIcon(districtStyles[key].color);
        }

        // å—äº¬å•†ä¸šé¡¹ç›®æ•°æ®
        var nanjing_malls = [
            // æ–°è¡—å£å•†åœˆ
            {name: "å—äº¬å¾·åŸºå¹¿åœº", lat: 32.044077, lng: 118.784902, address: "ä¸­å±±è·¯18å·", desc: "å•†ä¸šä½“é‡è¾¾31ä¸‡æ–¹ï¼Œæ˜¯æ–°è¡—å£'ç¾¤é›„ä¹‹é¦–'ã€‚2023å¹´é”€å”®é¢çº¦239äº¿å…ƒï¼Œä»…æ¬¡äºåŒ—äº¬SKPï¼Œä½åˆ—å…¨å›½ç¬¬äºŒã€‚", grade: "A+", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "å—äº¬ä¸­å¤®å•†åœº", lat: 32.038694, lng: 118.785311, address: "ä¸­å±±å—è·¯79å·", desc: "å—äº¬ç¬¬ä¸€åº§ç»¼åˆå•†åœºã€‚2023å¹´é”€å”®é¢çº¦70.3äº¿å…ƒï¼Œåœ¨å—äº¬ä½åˆ—ç¬¬äºŒã€‚", grade: "A+", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "å—äº¬æ–°ç™¾ä¸­å¿ƒ", lat: 32.040797, lng: 118.785067, address: "ä¸­å±±å—è·¯1å·", desc: "åˆ›å»ºäº1952å¹´ã€‚2023å¹´é”€å”®é¢55äº¿å…ƒï¼Œåœ¨å—äº¬ä½åˆ—ç¬¬ä¸‰ã€‚", grade: "A+", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "æ–°è¡—å£é‡‘é¹°å›½é™…è´­ç‰©ä¸­å¿ƒ", lat: 32.041429, lng: 118.779772, address: "æ–°è¡—å£æ±‰ä¸­è·¯89å·", desc: "1996å¹´å¼€ä¸šçš„è€ç‰Œå•†ä¸šé¡¹ç›®ã€‚2023å¹´é”€å”®é¢çº¦49äº¿å…ƒï¼Œåœ¨å—äº¬ä½åˆ—ç¬¬å››ã€‚", grade: "A+", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "å¤§æ´‹ç™¾è´§", lat: 32.138799, lng: 118.723738, address: "å¤§æ¡¥åŒ—è·¯48å·åä¸œèŒ‚C1æ ‹", desc: "", grade: "", district: "æ¡¥åŒ—å•†åœˆ"},
            {name: "ä¸œæ–¹å•†åŸ", lat: 32.047938, lng: 118.799953, address: "ç æ±Ÿè·¯517å·(æµ®æ¡¥åœ°é“ç«™3Aå£æ­¥è¡Œ330ç±³)", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "ISTè‰¾å°šå¤©åœ°è´­ç‰©ä¸­å¿ƒ", lat: 32.046868, lng: 118.784755, address: "ä¸­å±±è·¯100å·å‡¯æ¶¦é‡‘åŸ02å¹¢", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "ä¸‡è¾¾å•†ä¸šå¤§å¦", lat: 32.044000, lng: 118.785000, address: "æ±‰ä¸­è·¯89å·", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "æ–°è¡—å£å›½é™…é‡‘èä¸­å¿ƒ", lat: 32.041004, lng: 118.783207, address: "æ±‰ä¸­è·¯1å·(æ–°è¡—å£åœ°é“ç«™16å·å£æ—)", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "æ–°è¡—å£å°è±¡æ±‡", lat: 32.038085, lng: 118.786696, address: "æ´ªæ­¦è·¯88å·(æ–°è¡—å£åœ°é“ç«™å‡ºå…¥å£æ­¥è¡Œ260ç±³)", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "æ–°è¡—å£è‹å®ç”Ÿæ´»å¹¿åœº", lat: 32.036836, lng: 118.786544, address: "æ·®æµ·è·¯88å·è‹å®ç”Ÿæ´»å¹¿åœº(æ–°è¡—å£åº—)", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "é¼“æ¥¼å¾æ‚¦å¹¿åœº", lat: 32.067073, lng: 118.776628, address: "æ¹–åŒ—è·¯51å·ç‹®å­æ¡¥æ­¥è¡Œè¡—å¯¹é¢", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "è‹å®ç¯çƒè´­ç‰©ä¸­å¿ƒ", lat: 32.069518, lng: 118.777984, address: "æ¹–å—è·¯18å·", desc: "", grade: "", district: "æ–°è¡—å£å•†åœˆ"},

            // å¤«å­åº™å•†åœˆ
            {name: "é¹æ¬£Â·æ°´æ¸¸åŸ", lat: 32.023772, lng: 118.785874, address: "å»ºåº·è·¯1å·", desc: "2008å¹´å¼€ä¸šï¼Œä»¥æµåŠ¨çš„æ°´ä¸ºä¸»ä½“ï¼Œå•†ä¸šåœºæ™¯åˆ›æ„åè¶³ã€‚æ•´ä½“å“ç‰Œæ„é€ è¾ƒä¸º'æ¥åœ°æ°”'ï¼Œå¯¹å¹´è½»å®¢ç¾¤è¾ƒæœ‰å¸å¼•åŠ›ã€‚", grade: "A-", district: "å¤«å­åº™å•†åœˆ"},
            {name: "å—äº¬ä¸‡è±¡å¤©åœ°", lat: 32.021543, lng: 118.779988, address: "ä¸­å±±å—è·¯666å·(ä¸‰å±±è¡—åœ°é“ç«™1å·å£æ—)", desc: "å•†ä¸šåœºæ™¯ç‹¬ç‰¹ï¼Œç”±'Mall+è¡—åŒº+å¤å»º'ç»„æˆã€‚2023å¹´é”€å”®é¢çº¦ä¸º13äº¿å…ƒã€‚å›Šæ‹¬å›½å†…å¤–256å®¶å“ç‰Œï¼ŒåŸå¸‚'é¦–è¿›'å’Œ'å®šåˆ¶æ¦‚å¿µåº—'å æ¯”è¶…è¿‡60%ã€‚", grade: "A", district: "å¤«å­åº™å•†åœˆ"},
            {name: "æ°´å¹³æ–¹", lat: 32.023549, lng: 118.787141, address: "å»ºåº·è·¯3å·(å¤«å­åº™åœ°é“ç«™6å·å£æ­¥è¡Œ310ç±³)", desc: "", grade: "", district: "å¤«å­åº™å•†åœˆ"},
            {name: "èŒ‚ä¸šå¤©åœ°", lat: 32.022330, lng: 118.785500, address: "ä¸­åè·¯ä¸å»ºåº·è·¯äº¤æ±‡å¤„(ä¸‰å±±è¡—åœ°é“ç«™å‡ºå…¥å£æ­¥è¡Œ430ç±³)", desc: "", grade: "", district: "å¤«å­åº™å•†åœˆ"},
            {name: "å—äº¬ç»å›­å¥¥ç‰¹è±æ–¯", lat: 32.019073, lng: 118.786886, address: "å¤«å­åº™ç»å›­è·¯9å·", desc: "", grade: "", district: "å¤«å­åº™å•†åœˆ"},
            {name: "äº¬ä¸œMALL(å—äº¬å¤§æ˜è·¯åº—)", lat: 31.987528, lng: 118.800522, address: "å¤§æ˜è·¯288å·", desc: "", grade: "", district: "å¤«å­åº™å•†åœˆ"},
            {name: "å—äº¬é‡‘é™µä¸‡è±¡åŸ(å»ºè®¾ä¸­)", lat: 31.998175, lng: 118.822314, address: "æœºåœºå¤§é“ä¸ç¥¥å¤©è·¯äº¤å‰å£(å¤§æ ¡åœºåœ°é“ç«™2å·å£æ—)", desc: "", grade: "", district: "å¤«å­åº™å•†åœˆ"},
            
            // å…ƒé€šå•†åœˆ
            {name: "å—äº¬IFC", lat: 31.993728, lng: 118.721767, address: "æ±Ÿä¸œä¸­è·¯345å·", desc: "2024å¹´1æœˆä»½æ­£å¼å¼€ä¸šã€‚å¼•å…¥LOUIS VUITTONã€CHANELã€DioRã€GUCClç­‰ä¸€çº¿é‡å¥¢å“ç‰Œã€‚ç´§é‚»æ­£åœ¨å»ºè®¾çš„æ²³è¥¿å¾·åŸºå¹¿åœºã€‚", grade: "A+", district: "å…ƒé€šå•†åœˆ"},
            {name: "åé‡‡å¤©åœ°", lat: 31.997979, lng: 118.721393, address: "æ±Ÿä¸œä¸­è·¯258å·(å…ƒé€šåœ°é“ç«™å‡ºå…¥å£æ—)", desc: "", grade: "", district: "å…ƒé€šå•†åœˆ"},
            {name: "é¾™æ¹–å—äº¬æ²³è¥¿å¤©è¡—", lat: 31.987983, lng: 118.738082, address: "äº‘é¾™å±±è·¯89å·æ²³è¥¿å¤©è¡—", desc: "", grade: "", district: "å…ƒé€šå•†åœˆ"},
            {name: "é‡‘æºå¹¿åœº", lat: 31.995928, lng: 118.724420, address: "æ±Ÿä¸œä¸­è·¯341å·æ²³è¥¿ä¸­å¤®å…¬å›­", desc: "", grade: "", district: "å…ƒé€šå•†åœˆ"},
            {name: "ä»æ’é‡ŒåŒä¹åŠ", lat: 31.997694, lng: 118.713578, address: "ç™½é¾™æ±Ÿè¥¿è¡—ä»æ’æ±Ÿæ¹¾åŸäºŒæœŸå—é—¨", desc: "", grade: "", district: "å…ƒé€šå•†åœˆ"},
            {name: "å°æ¹¾åå“åŸ", lat: 32.000333, lng: 118.718264, address: "ç‡•å±±è·¯ä¸æ¥ æºªæ±Ÿè¥¿è¡—äº¤å‰å£è¥¿å—80ç±³", desc: "", grade: "", district: "å…ƒé€šå•†åœˆ"},
            {name: "åæ¶¦è‹æœè´­ç‰©ä¸­å¿ƒ", lat: 32.000000, lng: 118.720000, address: "æ±Ÿä¸œä¸­è·¯258å·", desc: "", grade: "", district: "å…ƒé€šå•†åœˆ"},
            {name: "æ ¼ç›å¹¿åœº", lat: 31.997927, lng: 118.727091, address: "æ²³è¥¿ä¸­å¤®å•†åŠ¡åŒºåºå±±è·¯188å·æ–°åœ°ä¸­å¿ƒäºŒæœŸä¸€æ¥¼", desc: "", grade: "", district: "å…ƒé€šå•†åœˆ"},
            
            // æ±Ÿä¸œå•†åœˆ
            {name: "åæ–°ä¸½åå•†ä¸šå¹¿åœº", lat: 31.999042, lng: 118.722631, address: "æ±Ÿä¸œä¸­è·¯ä¸å¯Œæ˜¥æ±Ÿè¥¿è¡—äº¤å‰å£", desc: "", grade: "", district: "æ±Ÿä¸œå•†åœˆ"},
            {name: "å·§åˆ»å¹¿åœºCHOC PARK", lat: 32.016156, lng: 118.732704, address: "å…´éš†å¤§è¡—156å·(å…´éš†å¤§è¡—åœ°é“ç«™2å·å£æ­¥è¡Œ340ç±³)", desc: "", grade: "", district: "æ±Ÿä¸œå•†åœˆ"},
            {name: "å—äº¬é‡‘é¹°ä¸–ç•Œ", lat: 32.023309, lng: 118.740263, address: "åº”å¤©å¤§è¡—888å·", desc: "å…¨çƒæœ€é«˜çš„ä¸‰å¡”è¿ä½“å»ºç­‘ä¹‹ä¸€ã€‚æ€»å»ºç­‘é¢ç§¯91.8ä¸‡mÂ²ï¼Œè´­ç‰©ä¸­å¿ƒä½“é‡çº¦35ä¸‡mÂ²ã€‚2023å¹´é”€å”®é¢çº¦32äº¿å…ƒã€‚", grade: "A+", district: "æ±Ÿä¸œå•†åœˆ"},
            {name: "å»ºé‚ºä¸‡è¾¾å¹¿åœº", lat: 32.032697, lng: 118.735738, address: "æ±Ÿä¸œä¸­è·¯98å·", desc: "äº2009å¹´å¼€ä¸šï¼Œæ˜¯æ²³è¥¿çš„é‡è¦å•†ä¸š'å·¨èˆ°'ã€‚å•†ä¸šæ€»å»ºé¢é«˜è¾¾120ä¸‡mÂ²ï¼Œè´­ç‰©ä¸­å¿ƒä½“é‡27ä¸‡mÂ²ã€‚", grade: "A", district: "æ±Ÿä¸œå•†åœˆ"},
            {name: "å»ºé‚ºå¾æ‚¦å¹¿åœº", lat: 32.037628, lng: 118.735845, address: "ç‡•å±±è·¯ä¸æ±‰ä¸­é—¨å¤§è¡—äº¤å‰å£å—80ç±³", desc: "", grade: "", district: "æ±Ÿä¸œå•†åœˆ"},
            {name: "å—äº¬ä¹åŸºå¹¿åœº", lat: 32.023836, lng: 118.743585, address: "æ‰€è¡—169å·", desc: "", grade: "", district: "æ±Ÿä¸œå•†åœˆ"},
            
            // æ±ŸåŒ—å•†åœˆ
            {name: "å—äº¬æ±ŸåŒ—è™¹æ‚¦åŸ", lat: 32.067162, lng: 118.640030, address: "é¾™åè·¯1å·", desc: "2021å¹´12æœˆåº•è¥ä¸šï¼Œå®šä½ä¸º'å…¨æ—¶éƒ½ä¼šç”Ÿæ´»èšåœº'ã€‚å•†ä¸šä½“é‡çº¦10ä¸‡æ–¹ã€‚è‡ªè¥500mÂ²çš„åˆ›æ„å‰§åœºï¼Œå¯ä¸¾åŠä¸°å¯Œæ´»åŠ¨ã€‚", grade: "A-", district: "æ±ŸåŒ—å•†åœˆ"},
            {name: "å—äº¬ä¸œæ–¹ä¸‡æ±‡åŸ", lat: 32.064395, lng: 118.656840, address: "æµ¦å£å¤§é“æ˜å‘è´¢å¯Œä¸­å¿ƒè¥¿åŒ—ä¾§70ç±³", desc: "", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            {name: "ç ‚ä¹‹èˆ¹å¥¥è±(å—äº¬æ±ŸåŒ—æ–°åŒºåº—)", lat: 32.042223, lng: 118.653417, address: "åŸå—æ²³è·¯93å·", desc: "", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            {name: "å®éš†æ—¶ä»£å¹¿åœº", lat: 32.054081, lng: 118.638380, address: "æ±Ÿæµ¦è¡—é“æ–°æµ¦è·¯", desc: "", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            {name: "çº¢æ˜Ÿç¾å‡¯é¾™ï¼ˆæ±ŸåŒ—æ–°åŒºå•†åœºï¼‰", lat: 32.069849, lng: 118.645858, address: "æµ¦å£å¤§é“18å·(å—äº¬å·¥ä¸šå¤§å­¦åœ°é“ç«™2å·å£æ­¥è¡Œ350ç±³)", desc: "", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            {name: "é¾™æ¹–å—äº¬é›¨å±±å¤©è¡—", lat: 32.045163, lng: 118.613656, address: "å…‰æ˜è·¯59å·(é›¨å±±è·¯åœ°é“ç«™6å·å£ç›´è¾¾)", desc: "", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            {name: "é›¨å±±å¹¿åœº", lat: 32.041997, lng: 118.615301, address: "å…‰æ˜è·¯ä¸å»ºè®¾è·¯äº¤å‰å£å—220ç±³", desc: "", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            {name: "é‡‘æµ¦è´­ç‰©ä¸­å¿ƒ", lat: 32.058938, lng: 118.628999, address: "ç æ±Ÿé•‡æ–‡å¾·è·¯3å·(æ–‡å¾·è·¯åœ°é“ç«™1å·å£æ­¥è¡Œ220ç±³)", desc: "", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            
            // æ¡¥åŒ—å•†åœˆ
            {name: "å—äº¬å¼˜é˜³å¹¿åœº", lat: 32.137333, lng: 118.726544, address: "å¤§æ¡¥åŒ—è·¯48å·", desc: "å•†ä¸šä½“é‡é«˜è¾¾55ä¸‡mÂ²ï¼Œæ˜¯å—äº¬é¦–ä¸ª'åŒMall+æ¸¸ä¹æ¼”è‰º'çš„è¶…å¤§å‹æ–‡å•†æ—…ç»¼åˆä½“ã€‚2023å¹´é”€å”®é¢26äº¿å…ƒï¼Œå¹´å®¢æµé‡é«˜è¾¾5000ä¸‡äººæ¬¡ï¼Œå‡æ’åœ¨å—äº¬TOP10ã€‚", grade: "A+", district: "æ¡¥åŒ—å•†åœˆ"},
            {name: "æ¡¥åŒ—ä¸‡è±¡æ±‡", lat: 32.124928, lng: 118.730534, address: "æ±ŸåŒ—æ–°åŒºæµ¦ç åŒ—è·¯1å·ä¸‡è±¡æ±‡L501å·", desc: "", grade: "", district: "æ¡¥åŒ—å•†åœˆ"},
            {name: "å—äº¬å°è±¡æ±‡", lat: 32.140459, lng: 118.722304, address: "å¤§æ¡¥åŒ—è·¯58å·", desc: "", grade: "", district: "æ¡¥åŒ—å•†åœˆ"},
            {name: "è‹å°šç”Ÿæ´»å¹¿åœº", lat: 32.130620, lng: 118.719265, address: "æµ¦å¤–è·¯28å·08æ ‹", desc: "", grade: "", district: "æ¡¥åŒ—å•†åœˆ"},
            {name: "å¤ªå¹³å•†åœºï¼ˆæ¡¥åŒ—å¸¦åº—ï¼‰", lat: 32.132958, lng: 118.730151, address: "å¤§æ¡¥åŒ—è·¯24å·é‡‘ç››å›½é™…å®¶å±…F1-F4å±‚", desc: "", grade: "", district: "æ¡¥åŒ—å•†åœˆ"},
            {name: "é‡‘è±¡åŸè´­ç‰©ä¸­å¿ƒ", lat: 32.127529, lng: 118.736095, address: "æ±Ÿå±±è·¯8å·", desc: "", grade: "", district: "æ¡¥åŒ—å•†åœˆ"},
            {name: "å¤©æ‚¦åŸ", lat: 32.151672, lng: 118.733296, address: "ç™¾æ¶¦è·¯9å·(å¤©æ¶¦åŸåœ°é“ç«™1å·å£æ­¥è¡Œ60ç±³)", desc: "", grade: "", district: "æ¡¥åŒ—å•†åœˆ"},
            
            // ç™¾å®¶æ¹–å•†åœˆ
            {name: "å—äº¬æ±¤å±±ç™¾è”å¥¥ç‰¹è±æ–¯å¹¿åœº", lat: 32.029200, lng: 119.052030, address: "åœ£æ±¤å¤§é“99å·(æ³‰éƒ½å¤§è¡—åœ°é“ç«™2å·å£æ­¥è¡Œ360ç±³)", desc: "", grade: "", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            {name: "æ™¯æ«ä¸­å¿ƒ", lat: 31.929864, lng: 118.820622, address: "åŒé¾™å¤§é“1698å·(ç™¾å®¶æ¹–åœ°é“ç«™1å·å£æ­¥è¡Œ180ç±³)", desc: "è´­ç‰©ä¸­å¿ƒå•†ä¸šä½“é‡çº¦11ä¸‡mÂ²ã€‚å¤§åŠ›å‘å±•é¦–åº—ç»æµã€‚2023å¹´é”€å”®é¢çº¦37.05äº¿å…ƒï¼Œä½åˆ—å—äº¬è´­ç‰©ä¸­å¿ƒç¬¬äº”ã€‚", grade: "A+", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            {name: "æ±Ÿå®é‡‘é¹°å¤©åœ°", lat: 31.932051, lng: 118.820171, address: "åŒé¾™å¤§é“1688å·(ç™¾å®¶æ¹–åœ°é“ç«™2å·å£æ­¥è¡Œ310ç±³)", desc: "å•†ä¸šä½“é‡çº¦13ä¸‡mÂ²ï¼Œå®šä½ä¸º'å…¨ç”Ÿæ´»ä¸­å¿ƒ'ã€‚å»å¹´é”€å”®é¢çº¦ä¸º19äº¿å…ƒã€‚", grade: "A+", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            {name: "ç™¾å®¶æ¹–1912", lat: 31.930832, lng: 118.818167, address: "ç»æµæŠ€æœ¯å¼€å‘åŒºåŒé¾™å¤§é“1680å·", desc: "ä¸´æ¹–è€Œå»ºï¼Œæ˜¯èåˆå•†åŠ¡ç¤¾äº¤ã€ä¼‘é—²æ¸¸ä¹çš„æ°‘å›½é£æƒ…ä¸»é¢˜åˆ›æ–°è¡—åŒºã€‚å¤§åŠ›å‘å±•'å¤œç»æµ'ã€‚", grade: "C", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            {name: "åŒæ›¦ä¸‡å°šåŸ", lat: 31.942414, lng: 118.822220, address: "åŒé¾™å¤§é“1351å·(èƒœå¤ªè·¯åœ°é“ç«™1å·å£å‡ºå£)", desc: "", grade: "", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            {name: "21ä¸–çºªå¤ªé˜³åŸ", lat: 31.927059, lng: 118.825244, address: "åŒé¾™å¤§é“1539å·", desc: "", grade: "", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            {name: "æ±Ÿå®ä¸‡è¾¾å¹¿åœº", lat: 31.951602, lng: 118.843185, address: "ç«¹å±±è·¯68å·", desc: "", grade: "", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            {name: "é¾™æ¹–å—äº¬é¾™æ¹¾å¤©è¡—", lat: 31.938242, lng: 118.843327, address: "ä¸œå±±è¡—é“æ½­å›­è¥¿è·¯199å·", desc: "", grade: "", district: "ç™¾å®¶æ¹–å•†åœˆ"},
            
            // ä»™æ—å•†åœˆ
            {name: "é‡‘é¹°æ¹–æ»¨å¤©åœ°", lat: 32.100412, lng: 118.925085, address: "ä»™æ—å­¦æµ·è·¯1å·", desc: "BåŒºå•†ä¸šç»¼åˆä½“å’ŒAåŒºå¥¥è±åŸéš”æ¹–ç›¸æœ›ï¼Œé€šè¿‡'æ¹–é¢æ ˆæ¡¥'è”é€šã€‚æ‹¥æœ‰é›¶å”®å•†ä¸šã€é¤é¥®ç¾é£Ÿã€æ–‡åˆ›è‰ºæœ¯ç­‰å¤šå…ƒä¸šæ€ã€‚2023å¹´é”€å”®é¢ä¸º22äº¿å…ƒã€‚", grade: "B", district: "ä»™æ—å•†åœˆ"},
            {name: "å¾·åŸºæ–‡åŒ–è‰ºæœ¯é«˜ç«¯å•†ä¸šä¸­å¿ƒ", lat: 32.082122, lng: 118.889404, address: "ç´«æ°”è·¯ä¸ä¸œæ¥è·¯äº¤å‰å£è¥¿100ç±³", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            {name: "å—äº¬ç¾ç³–å¹¿åœº", lat: 32.100383, lng: 118.932523, address: "ä»™æ—è¡—é“æ‰æ¹–ä¸œè·¯16å·", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            {name: "ç¾å±…ç”Ÿæ´»å¹¿åœº", lat: 32.096278, lng: 118.910208, address: "æ–‡æ¢ä¸œè·¯1å·", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            {name: "çˆ±å°šè¡—åŒºè´­ç‰©å¹¿åœº", lat: 32.092185, lng: 118.916837, address: "ä»™æ—å­¦è¡¡è·¯1å·(å­¦åˆ™è·¯åœ°é“ç«™2å·å£æ­¥è¡Œ70ç±³)", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            {name: "ä»™æ—ä¹éœ„æ¢¦å¤©åœ°", lat: 32.095000, lng: 118.918000, address: "ä»™æ—å­¦è¡¡è·¯1å·(å­¦åˆ™è·¯åœ°é“ç«™2å·å£æ­¥è¡Œ70ç±³)", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            {name: "å—äº¬ä¸œåŸæ±‡", lat: 32.097537, lng: 118.909043, address: "æ–‡è‹‘è·¯8å·", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            {name: "å—äº¬ä¸‡è¾¾èŒ‚", lat: 32.121490, lng: 118.989691, address: "ä»™æ—å¤§é“181å·", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            {name: "ä»™é¹¤æ–°å¤©åœ°å¹¿åœº", lat: 32.085308, lng: 118.903798, address: "é¹¤é¸£è·¯6å·(ä»™é¹¤é—¨åœ°é“ç«™1å·å£æ­¥è¡Œ290ç±³)", desc: "", grade: "", district: "ä»™æ—å•†åœˆ"},
            
            // æµ¦å£å•†åœˆ
            {name: "å—äº¬å¤§æ‚¦åŸ", lat: 32.049213, lng: 118.646885, address: "åº·ç››è·¯ä¸ä¸œä¸Šè·¯äº¤å‰å£è¥¿å—180ç±³", desc: "å»ºè®¾ä¸­", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "é‡‘ç››ç”°å¹¿åœº", lat: 32.069748, lng: 118.639324, address: "é¾™åè·¯8å·", desc: "", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "åä¾¨å¹¿åœº", lat: 32.128336, lng: 118.728787, address: "æµ¦å£åŒºæ³°å±±è¡—é“å¤§æ¡¥åŒ—è·¯1å·", desc: "", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "é‡‘ç››ç™¾è´§(é•¿æ±Ÿè·¯åº—)", lat: 32.045033, lng: 118.790624, address: "ç„æ­¦åŒºæ–°è¡—å£è¡—é“é•¿æ±Ÿè·¯9å·", desc: "", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "æ˜å‘å¤–æ»©å¹¿åœº", lat: 32.131169, lng: 118.742714, address: "æµ¦å£åŒºæ»¨æ±Ÿå¤§é“1å·æ˜å‘æ»¨æ±Ÿæ–°åŸ", desc: "", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "é‡‘éƒ½æ±‡å¹¿åœº", lat: 32.134964, lng: 118.725312, address: "æµ¦å£åŒºå¤§æ¡¥åŒ—è·¯37å·", desc: "", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "è‹å®ç¯çƒç™¾è´§å¸‚åœº", lat: 32.143480, lng: 118.724266, address: "æµ¦å£åŒºæŸ³å·ä¸œè·¯1å·", desc: "", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "äº¬æ–°é‚»é‡Œä¸­å¿ƒ", lat: 32.142030, lng: 118.743301, address: "æµ¦å£åŒºæ²¿æ±Ÿè¡—é“æŸ³æ´²ä¸œè·¯189å·", desc: "", grade: "", district: "æµ¦å£å•†åœˆ"},
            
            // ç„æ­¦å•†åœˆ
            {name: "ä¸­å—é­”åŠ›æœˆå…‰å¹¿åœº", lat: 32.086237, lng: 118.902980, address: "é¹¤é¸£è·¯8å·", desc: "", grade: "", district: "ç„æ­¦å•†åœˆ"},
            
            // ä¸­å¤®é—¨å•†åœˆ
            {name: "å—äº¬ç¯å®‡åŸ", lat: 32.044684, lng: 118.752780, address: "æ¸…å‡‰é—¨å¤§è¡—1å·", desc: "", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            {name: "å—äº¬å•†å¦", lat: 32.091004, lng: 118.784947, address: "é¾™èŸ è·¯1å·(è¿‘ä¸­å¤®é—¨ç«‹äº¤æ¡¥)", desc: "", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            {name: "ç‰æ¡¥å•†ä¸šå¹¿åœº", lat: 32.091149, lng: 118.781060, address: "å»ºå®è·¯8å·", desc: "", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            {name: "é‡‘æ¡¥å¹¿åœº", lat: 32.091452, lng: 118.778750, address: "å»ºå®è·¯12å·", desc: "", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            {name: "å…ˆé”‹å¥¥ç‰¹è±æ–¯å•†åœº", lat: 32.087613, lng: 118.783230, address: "ä¸­å¤®è·¯417å·", desc: "", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            {name: "èŠ±æ ·å¹´å–œå¹´ä¸­å¿ƒ", lat: 32.097661, lng: 118.780673, address: "åŒ—ç¥¥è·¯58å·å–œå¹´èŠ±ç”Ÿå”F1å±‚", desc: "", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            {name: "é‡‘èŒ‚è§ˆç§€åŸ", lat: 32.072677, lng: 118.783404, address: "ä¸­å¤®è·¯201å·(ç„æ­¦é—¨åœ°é“ç«™2å·å£æ­¥è¡Œ50ç±³)", desc: "", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            {name: "åè´¸ä¸­å¿ƒè´­ç‰©ä¸­å¿ƒ", lat: 32.079991, lng: 118.782318, address: "ä¸­å¤®è·¯339å·(æ–°æ¨¡èŒƒé©¬è·¯åœ°é“ç«™2å·å£æ­¥è¡Œ390ç±³)", desc: "è£…ä¿®ä¸­", grade: "", district: "ä¸­å¤®é—¨å•†åœˆ"},
            
            // è¿ˆçš‹æ¡¥å•†åœˆ
            {name: "ä¸‡è°·æ…§ç”Ÿæ´»å¹¿åœº", lat: 32.101771, lng: 118.813534, address: "åç”µè·¯1å·(è¿ˆçš‹æ¡¥åœ°é“ç«™4å·å£æ­¥è¡Œ340ç±³)", desc: "", grade: "", district: "è¿ˆçš‹æ¡¥å•†åœˆ"},
            {name: "å¸¸å‘å¹¿åœº", lat: 32.085690, lng: 118.810897, address: "çº¢å±±è·¯88å·", desc: "", grade: "", district: "è¿ˆçš‹æ¡¥å•†åœˆ"},
            {name: "å…­è§’å¹¿åœº", lat: 32.080830, lng: 118.810761, address: "ç„æ­¦å¤§é“6å·", desc: "", grade: "", district: "è¿ˆçš‹æ¡¥å•†åœˆ"},
            {name: "å½©è™¹å¹¿åœº", lat: 32.118203, lng: 118.820022, address: "å’Œç‡•è·¯408å·å®‡ä¸šæ™“åº„å›½é™…å¹¿åœº", desc: "", grade: "", district: "è¿ˆçš‹æ¡¥å•†åœˆ"},
            {name: "å—äº¬åŸåŒ—ä¸‡è±¡æ±‡", lat: 32.120701, lng: 118.834890, address: "æ –éœå¤§é“106-108å·", desc: "", grade: "", district: "è¿ˆçš‹æ¡¥å•†åœˆ"},
            
            // å…­åˆåŒºå•†åœˆ
            {name: "å—äº¬å…­åˆé¾™æ¹–å¤©è¡—", lat: 32.328530, lng: 118.843220, address: "å¤æ£ å¤§é“ä¸æ¡¥è¥¿è·¯äº¤æ±‡å¤„", desc: "", grade: "", district: "å…­åˆåŒºå•†åœˆ"},
            {name: "å—äº¬æ¬¢ä¹æ¸¯åº—(å…­åˆä¸‡è¾¾å¹¿åœºåº—)", lat: 32.335892, lng: 118.834737, address: "ä¸‡è¾¾å¹¿åœºæ¬¢ä¹æ¸¯(é›„å·åœ°é“ç«™4å·å£æ­¥è¡Œ100ç±³)", desc: "", grade: "", district: "å…­åˆåŒºå•†åœˆ"},
            
            // æº§æ°´åŒºå•†åœˆ
            {name: "å°è±¡å—äº¬(å—äº¬æº§æ°´ä¸‡è¾¾å¹¿åœºåº—)", lat: 31.626746, lng: 119.047236, address: "ä¸‡è¾¾å¹¿åœº(å—äº¬æº§æ°´åº—)(å¹¸åº„åœ°é“ç«™5å·å£æ­¥è¡Œ190ç±³)", desc: "", grade: "", district: "æº§æ°´åŒºå•†åœˆ"},
            
            // é«˜æ·³åŒºå•†åœˆ
            {name: "å…«ä½°ä¼´(å®å¡”è·¯)", lat: 31.324086, lng: 118.876001, address: "å®å¡”è·¯61å·", desc: "", grade: "", district: "é«˜æ·³åŒºå•†åœˆ"},
            
            // æ –éœåŒºå•†åœˆ
            {name: "å¥åº·Â·å¤§èåŸ", lat: 32.048530, lng: 118.894865, address: "ä¸­å±±é—¨å¤§è¡—ä¸ä¸œå®¶å²—è·¯äº¤å‰å£ä¸œå—140ç±³", desc: "", grade: "", district: "æ –éœåŒºå•†åœˆ"},
            {name: "é©¬ç¾¤æ‹›å•†èŠ±å›­åŸ", lat: 32.050567, lng: 118.894826, address: "ä¸­å±±é—¨å¤§è¡—699å·(é©¬ç¾¤åœ°é“ç«™3å·å£æ­¥è¡Œ220ç±³)", desc: "", grade: "", district: "æ –éœåŒºå•†åœˆ"},
            {name: "æ–°å°§é‡‘åœ°å¹¿åœº", lat: 32.124332, lng: 118.889030, address: "é‡‘å°§è·¯22å·(å°§åŒ–é—¨åœ°é“ç«™2å·å£æ­¥è¡Œ300ç±³)", desc: "", grade: "", district: "æ –éœåŒºå•†åœˆ"},
            
            // é›¨èŠ±å°å•†åœˆ
            {name: "æ˜å‘å•†ä¸šå¹¿åœº", lat: 31.977617, lng: 118.797664, address: "ç‰å…°è·¯99å·(æ˜å‘å¹¿åœºåœ°é“ç«™2Bå£æ­¥è¡Œ300ç±³)", desc: "", grade: "", district: "é›¨èŠ±å°å•†åœˆ"},
            {name: "å—äº¬é›¨èŠ±ä¸‡è±¡å¤©åœ°", lat: 31.960320, lng: 118.732801, address: "å‘ç§€è·¯1å·(è´¾è¥¿åœ°é“ç«™1å·å£æ­¥è¡Œ290ç±³)", desc: "", grade: "", district: "é›¨èŠ±å°å•†åœˆ"},
            {name: "å—äº¬è™¹æ‚¦åŸ", lat: 32.009485, lng: 118.765855, address: "åº”å¤©å¤§è¡—619å·", desc: "", grade: "", district: "é›¨èŠ±å°å•†åœˆ"},
            {name: "é›¨èŠ±å®¢å…", lat: 31.978904, lng: 118.764440, address: "å®‰å¾·é—¨å¤§è¡—47å·8å¹¢2æ¥¼14c", desc: "", grade: "", district: "é›¨èŠ±å°å•†åœˆ"},
            {name: "ç´«æ‚¦å¹¿åœº", lat: 31.979675, lng: 118.761860, address: "å®‰å¾·é—¨å¤§è¡—32å·(å¤©éš†å¯ºåœ°é“ç«™3å·å£æ­¥è¡Œ330ç±³)", desc: "", grade: "", district: "é›¨èŠ±å°å•†åœˆ"},
            {name: "å—äº¬è¯å¤§å–œç›æ‹‰é›…ä¸­å¿ƒ", lat: 31.966373, lng: 118.804061, address: "ä¸­å›½æ±Ÿè‹çœå—äº¬å¸‚é›¨èŠ±å°åŒºå—äº¬å—ç«™å—å¹¿åœºçš„ä¸œå—è§’é‡‘é˜³ä¸œè¡—ä¸å…­æœè·¯äº¤æ±‡å¤„å—äº¬å—ç«™ä¸€æ¥¼", desc: "", grade: "", district: "é›¨èŠ±å°å•†åœˆ"},
            
            // é«˜å¾·åœ°å›¾æŸ¥è¯¢æ–°å¢é¡¹ç›®
            {name: "æ–°ä¸–çºªå¹¿åœº(ç§‘å··)", lat: 32.040141, lng: 118.795239, address: "ä¸­å±±ä¸œè·¯370å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "CFCç”Ÿæ´»å¹¿åœº(é•¿å‘ä¸­å¿ƒåº—)", lat: 32.039832, lng: 118.797248, address: "ä¸­å±±ä¸œè·¯300å·(å¤§è¡Œå®«åœ°é“ç«™å‡ºå…¥å£æ­¥è¡Œ240ç±³)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "å¤ªå¹³å•†åœº", lat: 32.033359, lng: 118.792798, address: "å¤ªå¹³å—è·¯279å·(å¸¸åºœè¡—åœ°é“ç«™1å·å£æ­¥è¡Œ90ç±³)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ–°è¡—å£å•†åœˆ"},
            {name: "ä¸‡è±¡éƒ½èŸå•†ä¸šå¹¿åœº", lat: 31.998071, lng: 118.796944, address: "æ°¸ä¹è·¯16å·(å¡å­é—¨åœ°é“ç«™1å·å£æ­¥è¡Œ460ç±³)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "å¤«å­åº™å•†åœˆ"},
            {name: "å®œå®¶å®¶å±…(å—äº¬å•†åœºåº—)", lat: 31.993698, lng: 118.797188, address: "æ˜åŒ™è·¯99å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "å¤«å­åº™å•†åœˆ"},
            {name: "ç´«è†å¹¿åœºÂ·èŠ±æ¼«é‡Œ", lat: 31.992320, lng: 118.793732, address: "é›¨èŠ±ä¸œè·¯158å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "é›¨èŠ±å°å•†åœˆ"},
            {name: "é‡‘éš…INæœ‰è¡—å¸‚", lat: 31.909540, lng: 118.826803, address: "è¯šä¿¡å¤§é“669å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ±Ÿå®åŒºå•†åœˆ"},
            {name: "å›è¾¾æ˜“å±…ç”Ÿæ´»å¹¿åœº", lat: 31.902060, lng: 118.835081, address: "ä¹ç«¹è·¯58å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ±Ÿå®åŒºå•†åœˆ"},
            {name: "å®œæ‚¦é‡ŒG66åœ°ä¸‹åœè½¦åœº", lat: 31.933963, lng: 118.847174, address: "å¤©å…ƒä¸œè·¯15å·å®œæ‚¦é‡ŒG66(ç«¹å±±è·¯ç”µå­ä¸€æ¡è¡—åº—)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ±Ÿå®åŒºå•†åœˆ"},
            {name: "é‡‘å®å•†ä¸šå¹¿åœº(é‡‘ç®”è·¯åº—)", lat: 31.950176, lng: 118.855965, address: "é‡‘ç®”è·¯188å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ±Ÿå®åŒºå•†åœˆ"},
            {name: "æ£®æ—æ‘©å°”å•†ä¸šè¡—åŒº", lat: 32.038553, lng: 118.866479, address: "ä¸­å±±é—¨å¤§è¡—301å·(é’Ÿçµè¡—åœ°é“ç«™2Aå£æ­¥è¡Œ140ç±³)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "ç„æ­¦å•†åœˆ"},
            {name: "é’Ÿé¼åæ‚¦å¹¿åœº", lat: 32.036714, lng: 118.860272, address: "å­é™µå«è¡—é“ä¸­å±±é—¨å¤§è¡—297å·å­é™µå«é’Ÿé¼å±±åº„è¥¿å—", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "ç„æ­¦å•†åœˆ"},
            {name: "å›ä¸´ç´«é‡‘å•†ä¸šè¡—", lat: 32.037719, lng: 118.850353, address: "ä¸­å±±é—¨å¤§è¡—99å·(ä¸‹é©¬åŠåœ°é“ç«™1å·å£æ­¥è¡Œ70ç±³)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "ç„æ­¦å•†åœˆ"},
            {name: "ä½³æºå¹¿åœº", lat: 32.041100, lng: 118.880554, address: "å­é™µå«è¡—é“é¡¾å®¶è¥è·¯59å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "ç„æ­¦å•†åœˆ"},
            {name: "ç ‚ä¹‹èˆ¹å¥¥è±(å—äº¬æ±ŸåŒ—æ–°åŒºåº—)", lat: 32.042223, lng: 118.653417, address: "åŸå—æ²³è·¯93å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æ±ŸåŒ—å•†åœˆ"},
            
            // é«˜å¾·åœ°å›¾æŸ¥è¯¢æ–°å¢é¡¹ç›® (2025-10-06 14:06:40)
            {name: "åŠ›æœ‹å¹¿åœº", lat: 32.173190, lng: 118.710291, address: "é«˜æ–°è·¯23å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "é¾™æ¹–å—äº¬æ±ŸåŒ—å¤©è¡—", lat: 32.158664, lng: 118.698189, address: "æ–‡æ™¯è·¯99å·(æ˜Ÿç«è·¯åœ°é“ç«™2å·å£)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "å—äº¬è“å®çŸ³å¹¿åœº", lat: 32.160486, lng: 118.707691, address: "é«˜æ–°æŠ€æœ¯å¼€å‘åŒºé«˜æ–°è·¯5å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "æ¶¦è±¡æ±‡ç”Ÿæ´»å¹¿åœº", lat: 32.154321, lng: 118.718472, address: "æ³°å†¯è·¯59å·(æ³°å†¯è·¯åœ°é“ç«™6å·å£æ­¥è¡Œ60ç±³)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "é¸¿åˆ©å¹¿åœº", lat: 32.150398, lng: 118.734599, address: "ç™¾æ¶¦è·¯å¤©æ¶¦åŸåœ°é“3å·çº¿2å·å‡ºå£", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "æµ¦å¦å¹¿åœº", lat: 32.145824, lng: 118.714177, address: "æ³°è¥¿è·¯2å·(æ³°å±±æ–°æ‘åœ°é“ç«™2å·å£æ­¥è¡Œ350ç±³)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "é‡‘è¾‰å¹¿åœº", lat: 32.144395, lng: 118.711150, address: "æ³°è¥¿è·¯42-2å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "æ¾³æ—å¹¿åœº", lat: 32.112713, lng: 118.699832, address: "æµ¦ç åŒ—è·¯126å·", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "æµ¦å£å•†åœˆ"},
            {name: "ç†™å—é‡Œ", lat: 32.024967, lng: 118.781344, address: "ä¸­å±±å—è·¯400å·(ä¸‰å±±è¡—åœ°é“ç«™2å‡ºå£)", desc: "é«˜å¾·åœ°å›¾æŸ¥è¯¢é¡¹ç›®", grade: "", district: "å¤«å­åº™å•†åœˆ"}
        ];
        
        // æ·»åŠ å•†ä¸šé¡¹ç›®æ ‡è®°
        nanjing_malls.forEach(function(mall) {
            const style = districtStyles[mall.district];
            if (!style) {
                console.warn(`District "${mall.district}" not found in styles.`);
                return;
            }

            var gradeClass = "grade-none";
            if (mall.grade === "A+") gradeClass = "grade-Aplus";
            else if (mall.grade === "A") gradeClass = "grade-A";
            else if (mall.grade === "A-") gradeClass = "grade-Aminus";
            else if (mall.grade === "B") gradeClass = "grade-B";
            else if (mall.grade === "C") gradeClass = "grade-C";
            
            var popupContent = `<div class="popup-content">
                <b>${mall.name}</b><br>
                <span class="project-grade ${gradeClass}">${mall.grade || 'æœªè¯„çº§'}</span><br>
                <b>å•†åœˆï¼š</b>${mall.district}<br>
                <b>åœ°å€ï¼š</b>${mall.address}<br>`;
            
            if (mall.desc) {
                popupContent += `<b>ç®€ä»‹ï¼š</b>${mall.desc}<br>`;
            }

            popupContent += `<button class="poi-search-btn" onclick="openPoiSearch(${mall.lat}, ${mall.lng}, '${mall.name}')">æœç´¢å‘¨è¾¹</button>
            </div>`;
            
            L.marker([mall.lat, mall.lng], {icon: style.icon})
                .addTo(map)
                .bindPopup(popupContent);
        });
        
        // æ·»åŠ å›¾ä¾‹
        var legend = L.control({position: "bottomright"});
        legend.onAdd = function (map) {
            var div = L.DomUtil.create("div", "info legend");
            let content = "<h4>å•†åœˆå›¾ä¾‹</h4>";
            for (const key in districtStyles) {
                const style = districtStyles[key];
                content += `<i style='background: ${style.color}'></i> ${key}<br>`;
            }
            
            content += "<br><h4>é¡¹ç›®ç­‰çº§</h4>" +
                "<span class='project-grade grade-Aplus'>A+</span> é¡¶çº§é¡¹ç›®<br>" +
                "<span class='project-grade grade-A'>A</span> ä¼˜ç§€é¡¹ç›®<br>" +
                "<span class='project-grade grade-Aminus'>A-</span> è‰¯å¥½é¡¹ç›®<br>" +
                "<span class='project-grade grade-B'>B</span> ä¸€èˆ¬é¡¹ç›®<br>" +
                "<span class='project-grade grade-C'>C</span> åŸºç¡€é¡¹ç›®<br>" +
                "<span class='project-grade grade-none'>æœªè¯„çº§</span> ä¿¡æ¯å¾…è¡¥å……";

            div.innerHTML = content;
            return div;
        };
        legend.addTo(map);
        
        // æ·»åŠ æ ‡é¢˜
        var info = L.control({position: "topright"});
        info.onAdd = function (map) {
            var div = L.DomUtil.create("div", "info");
            div.innerHTML = "<h4>å—äº¬å¸‚é‡ç‚¹å•†ä¸šé¡¹ç›®åˆ†å¸ƒå›¾ (2025å¹´)</h4>" +
                "<p>å…±" + nanjing_malls.length + "ä¸ªå•†ä¸šé¡¹ç›®ï¼Œæ¶µç›–17å¤§å•†åœˆ</p>" +
                "<p>ç‚¹å‡»æ ‡è®°æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>";
            return div;
        };
        info.addTo(map);

        // --- POI Search Feature ---
        const amapApiKey = "c85d0ca7bc7107f785cc9d85cd400637";
        const poiSearchModal = document.getElementById('poi-search-modal');
        const poiModalTitle = document.getElementById('poi-modal-title');
        const poiKeywordInput = document.getElementById('poi-keyword-input');
        const poiSearchBtn = document.getElementById('poi-search-btn');
        const poiModalCloseBtn = document.getElementById('poi-modal-close-btn');
        const poiResultsContainer = document.getElementById('poi-results');
        const clearPoiBtn = document.getElementById('clear-poi-btn');
        let poiMarkersLayer = L.layerGroup().addTo(map);
        let currentSearchCenter = null;

        function openPoiSearch(lat, lng, mallName) {
            currentSearchCenter = { lat, lng };
            poiModalTitle.textContent = `åœ¨â€œ${mallName}â€å‘¨è¾¹æœç´¢`;
            poiSearchModal.style.display = 'flex';
            poiResultsContainer.innerHTML = ''; // Clear previous list results
        }

        function closePoiSearch() {
            poiSearchModal.style.display = 'none';
            // Markers are intentionally not cleared
        }

        function clearPoiResults() {
            poiMarkersLayer.clearLayers();
            if (clearPoiBtn) {
                clearPoiBtn.style.display = 'none';
            }
        }

        async function executePoiSearch() {
            const keyword = poiKeywordInput.value;
            if (!keyword) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            if (!currentSearchCenter) {
                alert('æœªé€‰æ‹©æœç´¢ä¸­å¿ƒç‚¹');
                return;
            }

            poiResultsContainer.innerHTML = 'æ­£åœ¨æœç´¢...';

            const location = `${currentSearchCenter.lng},${currentSearchCenter.lat}`;
            const radius = 3000; // 3km radius as requested
            const url = `https://restapi.amap.com/v3/place/around?key=${amapApiKey}&location=${location}&keywords=${encodeURIComponent(keyword)}&radius=${radius}&offset=50&page=1&extensions=all`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                poiResultsContainer.innerHTML = ''; // Clear "searching..." message
                if (data.status === '1' && data.pois.length > 0) {
                    displayPoiResults(data.pois);
                } else {
                    poiResultsContainer.innerHTML = 'æœªæ‰¾åˆ°ç›¸å…³åœ°ç‚¹ã€‚';
                }
            } catch (error) {
                console.error('POI search failed:', error);
                poiResultsContainer.innerHTML = 'æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–API Keyã€‚';
            }
        }

        function displayPoiResults(pois) {
            const poiIcon = L.divIcon({
                className: 'custom-div-icon',
                html: "<div style='background-color:#2ecc71;' class='marker-pin'></div>",
                iconSize: [15, 15],
                iconAnchor: [8, 8]
            });
            
            pois.forEach(poi => {
                const [lng, lat] = poi.location.split(',');
                const marker = L.marker([lat, lng], { icon: poiIcon }).addTo(poiMarkersLayer);
                marker.bindPopup(`<b>${poi.name}</b><br>${poi.address || ''}`);
                
                const resultItem = document.createElement('div');
                resultItem.className = 'poi-item';
                resultItem.textContent = `${poi.name} (${poi.distance}ç±³)`;
                poiResultsContainer.appendChild(resultItem);
            });

            if (clearPoiBtn && poiMarkersLayer.getLayers().length > 0) {
                clearPoiBtn.style.display = 'block';
            }
        }

        poiSearchBtn.addEventListener('click', executePoiSearch);
        poiModalCloseBtn.addEventListener('click', closePoiSearch);
        clearPoiBtn.addEventListener('click', clearPoiResults);
        window.openPoiSearch = openPoiSearch;

        // --- åŠŸèƒ½å¢å¼ºä»£ç å¼€å§‹ ---

        // 1. åˆå§‹åŒ–è·ç¦»æµ‹é‡æ§ä»¶å¹¶ç§»åŠ¨åˆ°æ§åˆ¶é¢æ¿å†…
        var measureControl = L.control.measure({
            position: 'topleft', // åˆå§‹ä½ç½®ï¼Œåç»­ä¼šç§»åŠ¨
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares',
            activeColor: '#db4a39',
            completedColor: '#c85353',
            localization: 'cn'
        });
        measureControl.addTo(map);

        // é¡µé¢åŠ è½½åï¼Œå°†æµ‹é‡å·¥å…·ç§»åŠ¨åˆ°æ§åˆ¶é¢æ¿ä¸­
        window.addEventListener('load', () => {
            const measureElement = document.querySelector('.leaflet-control-measure');
            const radiusControl = document.getElementById('radius-control');
            const firstElementInPanel = radiusControl.querySelector('.control-header').nextElementSibling;

            if (measureElement && radiusControl && firstElementInPanel) {
                // ç§»åŠ¨æ§ä»¶
                firstElementInPanel.parentNode.insertBefore(measureElement, firstElementInPanel);
                
                // è°ƒæ•´æ ·å¼ä»¥é€‚åº”æ–°å®¹å™¨
                measureElement.style.position = 'relative';
                measureElement.style.top = 'auto';
                measureElement.style.left = 'auto';
                measureElement.style.right = 'auto';
                measureElement.style.margin = '0 0 15px 0';
                measureElement.style.width = '100%';
                measureElement.style.boxShadow = 'none';
            }
        });

        // 2. å®ç°åŠå¾„æµ‹é‡åŠŸèƒ½
        let radiusCircles = [];
        let circleCounter = 1;
        const circleColors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#e67e22', '#1abc9c', '#34495e'];
        const radiusButton = document.getElementById('radius-button');
        const radiusInput = document.getElementById('radius-input');
        const radiusUnit = document.getElementById('radius-unit');
        const recordsList = document.getElementById('records-list');
        const clearAllBtn = document.getElementById('clear-all-btn');
        const noRecords = document.getElementById('no-records');
        let isInRadiusMode = false;

        function exitRadiusMode() {
            if (!isInRadiusMode) {
                return;
            }
            isInRadiusMode = false;
            map.getContainer().style.cursor = '';
            const promptDiv = document.getElementById('radius-mode-prompt');
            if (promptDiv) {
                promptDiv.remove();
            }
        }

        radiusButton.addEventListener('click', function(e) {
            e.stopPropagation(); // é˜²æ­¢ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘åœ°å›¾çš„ç‚¹å‡»äº‹ä»¶
            isInRadiusMode = true;
            map.getContainer().style.cursor = 'crosshair';
            
            // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§æç¤º
            let oldPrompt = document.getElementById('radius-mode-prompt');
            if(oldPrompt) oldPrompt.remove();

            // åˆ›å»ºæ–°çš„æç¤º
            let promptDiv = L.DomUtil.create('div', 'info', map.getContainer().parentElement);
            promptDiv.id = 'radius-mode-prompt';
            promptDiv.style.position = 'absolute';
            promptDiv.style.bottom = '30px';
            promptDiv.style.left = '50%';
            promptDiv.style.transform = 'translateX(-50%)';
            promptDiv.style.zIndex = '2000';
            promptDiv.style.backgroundColor = 'rgba(0, 0, 0, 0.75)';
            promptDiv.style.color = 'white';
            promptDiv.style.padding = '8px 15px';
            promptDiv.style.borderRadius = '30px';
            promptDiv.innerHTML = 'å·²è¿›å…¥èŒƒå›´æŸ¥è¯¢æ¨¡å¼ï¼Œè¯·åœ¨åœ°å›¾ä¸Šç‚¹å‡»ä¸€ä¸ªä¸­å¿ƒç‚¹ã€‚';
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isInRadiusMode) {
                exitRadiusMode();
            }
        });

        // åˆ›å»ºèŒƒå›´åœ†åœˆå‡½æ•°
        function createRadiusCircle(latlng, radiusValue, unit) {
            const radiusInMeters = unit === 'kilometers' ? radiusValue * 1000 : radiusValue;
            const colorIndex = (circleCounter - 1) % circleColors.length;
            const color = circleColors[colorIndex];
            
            const circle = L.circle(latlng, {
                radius: radiusInMeters,
                color: color,
                weight: 2,
                fillColor: color,
                fillOpacity: 0.15
            }).addTo(map);
            
            // è®¡ç®—èŒƒå›´å†…çš„å•†åœº
            const mallsInRange = nanjing_malls.filter(mall => {
                const mallLatLng = L.latLng(mall.lat, mall.lng);
                return latlng.distanceTo(mallLatLng) <= radiusInMeters;
            });
            
            const record = {
                id: circleCounter++,
                circle: circle,
                center: latlng,
                radius: radiusValue,
                unit: unit,
                color: color,
                timestamp: new Date(),
                mallsCount: mallsInRange.length,
                malls: mallsInRange
            };
            
            radiusCircles.push(record);
            
            // ä¸ºåœ†åœˆæ·»åŠ å³é”®åˆ é™¤åŠŸèƒ½
            circle.on('contextmenu', function(e) {
                e.originalEvent.preventDefault();
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæŸ¥è¯¢è®°å½•å—ï¼Ÿ')) {
                    removeCircle(record.id);
                }
            });
            
            // ç‚¹å‡»åœ†åœˆæ˜¾ç¤ºä¿¡æ¯
            circle.on('click', function(e) {
                if (!isInRadiusMode) {
                    const mallsList = mallsInRange.length > 0 ? 
                        mallsInRange.map(m => `â€¢ ${m.name} (${m.district})`).join('<br>') : 
                        'æ— å•†åœº';
                    
                    const popupContent = `
                        <div style="max-width: 250px;">
                            <b>æŸ¥è¯¢è®°å½• #${record.id}</b><br>
                            <b>åŠå¾„ï¼š</b>${radiusValue} ${unit === 'kilometers' ? 'å…¬é‡Œ' : 'ç±³'}<br>
                            <b>ä¸­å¿ƒï¼š</b>${latlng.lat.toFixed(4)}, ${latlng.lng.toFixed(4)}<br>
                            <b>åŒ…å«å•†åœºï¼š</b>${mallsInRange.length} ä¸ª<br>
                            <div style="max-height: 150px; overflow-y: auto; margin-top: 8px; font-size: 12px;">
                                ${mallsList}
                            </div>
                        </div>
                    `;
                    
                    L.popup()
                        .setLatLng(e.latlng)
                        .setContent(popupContent)
                        .openOn(map);
                }
            });
            
            updateRecordsList();
            map.fitBounds(circle.getBounds());
        }
        
        // åˆ é™¤å•ä¸ªåœ†åœˆ
        function removeCircle(id) {
            const index = radiusCircles.findIndex(record => record.id === id);
            if (index !== -1) {
                map.removeLayer(radiusCircles[index].circle);
                radiusCircles.splice(index, 1);
                updateRecordsList();
            }
        }
        
        // æ¸…é™¤æ‰€æœ‰åœ†åœˆ
        function clearAllCircles() {
            radiusCircles.forEach(record => {
                map.removeLayer(record.circle);
            });
            radiusCircles = [];
            updateRecordsList();
        }
        
        // æ›´æ–°è®°å½•åˆ—è¡¨
        function updateRecordsList() {
            const totalMalls = radiusCircles.reduce((sum, record) => sum + record.mallsCount, 0);
            const recordsStats = document.getElementById('records-stats');
            const totalRecordsSpan = document.getElementById('total-records');
            const totalMallsSpan = document.getElementById('total-malls');
            
            if (radiusCircles.length === 0) {
                noRecords.style.display = 'block';
                clearAllBtn.style.display = 'none';
                recordsStats.style.display = 'none';
                return;
            }
            
            noRecords.style.display = 'none';
            clearAllBtn.style.display = 'block';
            recordsStats.style.display = 'block';
            totalRecordsSpan.textContent = radiusCircles.length;
            totalMallsSpan.textContent = totalMalls;
            
            // ç§»é™¤æ—§çš„è®°å½•é¡¹
            const existingItems = recordsList.querySelectorAll('.record-item');
            existingItems.forEach(item => item.remove());
            
            // æ·»åŠ æ–°çš„è®°å½•é¡¹
            radiusCircles.forEach((record, index) => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'record-item';
                recordDiv.style.borderLeftColor = record.color;
                
                // æ„å»ºå•†åœºåˆ—è¡¨
                const mallsList = record.malls.length > 0 ? 
                    record.malls.slice(0, 3).map(m => `â€¢ ${m.name}`).join('<br>') + 
                    (record.malls.length > 3 ? `<br>... è¿˜æœ‰ ${record.malls.length - 3} ä¸ª` : '') 
                    : 'æ— å•†åœº';
                
                recordDiv.innerHTML = `
                    <div class="record-header">
                        <span class="record-title" style="color: ${record.color};">ğŸ“ è®°å½• #${record.id}</span>
                        <button class="record-delete" onclick="removeCircle(${record.id})">åˆ é™¤</button>
                    </div>
                    <div class="record-info">
                        <strong>åŠå¾„:</strong> ${record.radius} ${record.unit === 'kilometers' ? 'å…¬é‡Œ' : 'ç±³'}<br>
                        <strong>å•†åœºæ•°é‡:</strong> ${record.mallsCount} ä¸ª<br>
                        <strong>åˆ›å»ºæ—¶é—´:</strong> ${record.timestamp.toLocaleTimeString()}<br>
                        <details style="margin-top: 6px;">
                            <summary style="cursor: pointer; color: var(--secondary-color); font-weight: 600;">æŸ¥çœ‹åŒ…å«çš„å•†åœº</summary>
                            <div style="margin-top: 4px; font-size: 11px; line-height: 1.4;">
                                ${mallsList}
                            </div>
                        </details>
                    </div>
                `;
                recordsList.insertBefore(recordDiv, clearAllBtn);
            });
        }
        
        // åœ°å›¾ç‚¹å‡»äº‹ä»¶
        map.on('click', function(e) {
            if (!isInRadiusMode) {
                return;
            }

            let radius = parseFloat(radiusInput.value);
            if (isNaN(radius) || radius <= 0) {
                alert('è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„æ­£æ•°ä½œä¸ºåŠå¾„ï¼');
            } else {
                createRadiusCircle(e.latlng, radius, radiusUnit.value);
            }

            // é€€å‡ºåŠå¾„æ¨¡å¼
            exitRadiusMode();
        });
        
        // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
        const currentTab = document.getElementById('current-tab');
        const historyTab = document.getElementById('history-tab');
        let activeTab = 'current';
        
        currentTab.addEventListener('click', function() {
            if (activeTab !== 'current') {
                currentTab.classList.add('active');
                historyTab.classList.remove('active');
                activeTab = 'current';
                updateRecordsList();
            }
        });
        
        historyTab.addEventListener('click', function() {
            if (activeTab !== 'history') {
                historyTab.classList.add('active');
                currentTab.classList.remove('active');
                activeTab = 'history';
                updateRecordsList();
            }
        });
        
        // æ¸…é™¤æ‰€æœ‰è®°å½•æŒ‰é’®
        clearAllBtn.addEventListener('click', function() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æŸ¥è¯¢è®°å½•å—ï¼Ÿ')) {
                clearAllCircles();
            }
        });
        
        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.removeCircle = removeCircle;

        // --- ä¼˜åŒ–åçš„éšè—/æ¢å¤æ§åˆ¶é¢æ¿åŠŸèƒ½ ---
        const toggleControlBtn = document.getElementById('toggle-control');
        const radiusControl = document.getElementById('radius-control');

        // 1. åˆ›å»ºä¸€ä¸ªæ¢å¤æŒ‰é’®ï¼Œå¹¶æ·»åŠ åˆ°åœ°å›¾å®¹å™¨çš„çˆ¶èŠ‚ç‚¹ä¸­
        const showControlBtn = document.createElement('button');
        showControlBtn.id = 'show-control-btn';
        showControlBtn.innerHTML = 'ğŸ—ºï¸ æ˜¾ç¤ºæŸ¥è¯¢å·¥å…·';
        showControlBtn.style.position = 'absolute';
        showControlBtn.style.top = '10px';
        showControlBtn.style.right = '10px';
        showControlBtn.style.zIndex = '1001';
        showControlBtn.style.display = 'none'; // é»˜è®¤éšè—
        showControlBtn.style.padding = '10px 15px';
        showControlBtn.style.backgroundColor = 'var(--primary-color)';
        showControlBtn.style.color = 'white';
        showControlBtn.style.border = 'none';
        showControlBtn.style.borderRadius = 'var(--border-radius)';
        showControlBtn.style.cursor = 'pointer';
        showControlBtn.style.fontWeight = '600';
        showControlBtn.style.boxShadow = 'var(--box-shadow)';
        showControlBtn.title = 'ç‚¹å‡»ä»¥æ¢å¤æ˜¾ç¤ºèŒƒå›´æŸ¥è¯¢å·¥å…·é¢æ¿';
        map.getContainer().parentElement.appendChild(showControlBtn);

        // 2. ä¸ºæ§åˆ¶é¢æ¿å†…çš„â€œéšè—â€æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
        toggleControlBtn.addEventListener('click', function() {
            radiusControl.style.display = 'none'; // å®Œå…¨éšè—æ§åˆ¶é¢æ¿
            showControlBtn.style.display = 'block'; // æ˜¾ç¤ºæ¢å¤æŒ‰é’®
        });

        // 3. ä¸ºåœ°å›¾ä¸Šçš„â€œæ¢å¤â€æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬
        showControlBtn.addEventListener('click', function() {
            radiusControl.style.display = 'flex'; // æ¢å¤æ§åˆ¶é¢æ¿çš„æ˜¾ç¤º
            showControlBtn.style.display = 'none'; // éšè—æ¢å¤æŒ‰é’®
        });

        // --- çª—å£æ‹–åŠ¨åŠŸèƒ½ ---
        function makeElementDraggable(element, dragHandle) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            dragHandle.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                // æ£€æŸ¥ç‚¹å‡»ç›®æ ‡æ˜¯å¦ä¸ºè¾“å…¥æ¡†ã€æŒ‰é’®æˆ–å…¶ä»–äº¤äº’å…ƒç´ 
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA') {
                    return; // å¦‚æœæ˜¯äº¤äº’å…ƒç´ ï¼Œä¸è§¦å‘æ‹–åŠ¨
                }
                
                e = e || window.event;
                e.preventDefault();
                // è·å–é¼ æ ‡åˆå§‹ä½ç½®
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // è®¡ç®—æ–°ä½ç½®
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // è®¾ç½®å…ƒç´ æ–°ä½ç½®
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
                element.style.right = "auto";
                element.style.bottom = "auto";
            }
            
            function closeDragElement() {
                // åœæ­¢ç§»åŠ¨
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }
        
        // ä½¿æ§åˆ¶é¢æ¿å¯æ‹–åŠ¨ï¼Œä½†åªåœ¨æ ‡é¢˜æ ä¸Šæ‹–åŠ¨
        const controlHeader = document.querySelector('.control-header');
        if (controlHeader) {
            makeElementDraggable(radiusControl, controlHeader);
        } else {
            // å¦‚æœæ‰¾ä¸åˆ°æ ‡é¢˜æ ï¼Œå›é€€åˆ°æ•´ä¸ªé¢æ¿æ‹–åŠ¨ï¼ˆä½†æ·»åŠ äº¤äº’å…ƒç´ æ£€æŸ¥ï¼‰
            makeElementDraggable(radiusControl, radiusControl);
        }
        
        // ä½¿å›¾ä¾‹å’Œæ ‡é¢˜çª—å£å¯æ‹–åŠ¨
        setTimeout(() => {
            const legendControl = document.querySelector('.leaflet-control.leaflet-control-legend');
            const infoControl = document.querySelector('.leaflet-control.leaflet-control-info');
            
            if (legendControl) {
                const legendDiv = legendControl.querySelector('.info');
                if (legendDiv) {
                    makeElementDraggable(legendControl);
                }
            }
            
            if (infoControl) {
                const infoDiv = infoControl.querySelector('.info');
                if (infoDiv) {
                    makeElementDraggable(infoControl);
                }
            }
        }, 100);
        
        // â€œæ¢å¤åœ°å›¾åˆå§‹çŠ¶æ€â€åŠŸèƒ½å·²æ ¹æ®ç”¨æˆ·è¦æ±‚ç§»é™¤ã€‚


        // --- åŠŸèƒ½å¢å¼ºä»£ç ç»“æŸ ---
    </script>
</body>
</html>
